<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Connected Users</title>
  <script src="lib/jquery-1.11.1.min.js" type="text/javascript"></script>
  <script src="lib/jquery.dataTables.min.js" type="text/javascript"></script>
  <link href="lib/jquery.dataTables.css" rel="stylesheet" type="text/css">
</head>

<body style="font-size:small">
  <h1>OpenVPN4UCS: Users</h1>
  <table id="test" class="display" with="100%" cellspacing="0" border=1>
    <thead>
      <tr>
        <th>Name</th>
        <th>Connected</th>
        <th>Type</th>
        <th>Real Address</th>
        <th>Virtual Addresses</th>
        <th>Connected since</th>
        <th>Received</th>
        <th>Sent</th>
        <th>Disconnect</th>
      </tr>
    </thead>
  </table>

  <script>
$(document).ready(function() {
    $('#test').dataTable( {
        "processing": true,
        "paging": false,
        "bPaginate": false,
        "bInfo": false,
        "searching": false,
        "ajax": {
            "url": "//server_ip:8080/connected_users",
            "dataType": "jsonp",
            "dataSrc": function ( json ) {
                for (var i = 0, ien = json.data.length; i < ien; i++) {

                    // kill
                    realip = json.data[i].realip
                    if (realip != "") {
                        json.data[i].kill = '<a href="//server_ip:8080/kill_user/' + realip + '">Disconnect</a>'
                    } else {
                        json.data[i].kill = ''
                    }

                    // recv
                    recv = json.data[i].recv
                    json.data[i].recv = '<div align="right">' + recv + '</div>'

                    // sent
                    sent = json.data[i].sent
                    json.data[i].sent = '<div align="right">' + sent + '</div>'

                    // conn
                    connected = json.data[i].connected
                    if (connected == 0) {
                        json.data[i].connected = '<div align="center"><img src="graphics/green_off.png" alt="not connected" style="width:20px;height:20px" align="center"> <img src="graphics/red.png" alt="not connected" style="width:20px;height:20px" align="center"></div>'
                    } else {
                        json.data[i].connected = '<div align="center"><img src="graphics/green.png" alt="connected" style="width:20px;height:20px" align="center"> <img src="graphics/red_off.png" alt="connected" style="width:20px;height:20px" align="center"></div>'
                    }

                    // ipv
                    ipv = json.data[i].type
                    console.log("type: " + json.data[i].type)
                    switch(ipv) {
                        case 0:
                            json.data[i].type = '<div align="center"><img src="graphics/v4_off.png" alt="ipv4 off" style="width:20px;height:20px" align="center"><img src="graphics/v6_off.png" alt="ipv6 off" style="width:20px;height:20px" align="center"></div>'
                            break;
                        case 1:
                            json.data[i].type = '<div align="center"><img src="graphics/v4.png" alt="ipv4 on" style="width:20px;height:20px" align="center"><img src="graphics/v6_off.png" alt="ipv6 off" style="width:20px;height:20px" align="center"></div>'
                            break;
                        case 2:
                            json.data[i].type = '<div align="center"><img src="graphics/v4_off.png" alt="ipv4 off" style="width:20px;height:20px" align="center"><img src="graphics/v6.png" alt="ipv6 on" style="width:20px;height:20px" align="center"></div>'
                            break;
                        case 3:
                            json.data[i].type = '<div align="center"><img src="graphics/v4.png" alt="ipv4 on" style="width:20px;height:20px" align="center"><img src="graphics/v6.png" alt="ipv6 on" style="width:20px;height:20px" align="center"></div>'
                            break;
                        default:
                            json.data[i].type = 'unknown ipv'
                    }

                    console.log(json.data[i]);
                }
                return json.data;
            }
        },
        "columns": [
            { "data": "name" },
            { "data": "connected", "orderable": false },
            { "data": "type", "orderable": false },
            { "data": "realip" },
            { "data": "virtips" },
            { "data": "cons" },
            { "data": "recv" },
            { "data": "sent" },
            { "data": "kill", "orderable": false },
        ]
    } );
} );
  </script>

  <p style="position: absolute; bottom: 5px; right: 5px; text-align: right">Brought to you by bytemine.</p>
</body>
</html>
